<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start-UP - Платформа інновацій НПУ</title>

    <!-- Підключення Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Налаштування Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Import Map для роботи React прямо в браузері -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <!-- Babel для компіляції JSX в браузері -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Додаткові стилі для скролбару та ефектів */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        .drop-shadow-glow {
            filter: drop-shadow(0 0 10px rgba(234, 179, 8, 0.3));
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-100">
    <div id="root"></div>

    <!-- Основний код додатку -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import {
            Home, Lightbulb, Database, Phone, Search, ThumbsUp, ThumbsDown,
            MessageSquare, Send, User, Clock, Menu, X, ChevronRight, ChevronLeft, ShieldAlert, Loader2, Globe
        } from 'lucide-react';

        // --- КОНФІГУРАЦІЯ ---
        const API_URL = 'https://script.google.com/macros/s/AKfycbwLHz4q-vCrb7Li6lpfk-klHk17tBsU7jToNRdTLnmgg-EbjSyQwP-om0-5PzbGG_bq/exec';

        // --- КОМПОНЕНТИ ---
        const Logo = ({ className = "w-10 h-10" }) => (
            <div className={`relative flex items-center justify-center ${className}`}>
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full drop-shadow-glow">
                    <defs>
                        <linearGradient id="shieldGradient" x1="15" y1="5" x2="85" y2="95" gradientUnits="userSpaceOnUse">
                            <stop stopColor="#1e3a5f" />
                            <stop offset="1" stopColor="#0f2440" />
                        </linearGradient>
                    </defs>
                    <path d="M50 5L15 20V50C15 75 50 95 50 95C50 95 85 75 85 50V20L50 5Z" fill="url(#shieldGradient)" stroke="#ffd700" strokeWidth="2" />
                    <circle cx="50" cy="45" r="15" fill="#ffd700" fillOpacity="0.2" />
                    <path d="M50 30C41.7 30 35 36.7 35 45C35 51.5 39 57 44 59V63C44 64.1 44.9 65 46 65H54C55.1 65 56 64.1 56 63V59C61 57 65 51.5 65 45C65 36.7 58.3 30 50 30ZM48 68H52V70H48V68Z" fill="#ffd700" />
                </svg>
            </div>
        );

        const NavItem = ({ icon: Icon, label, isActive, onClick, isMobile = false }) => (
            <button
                onClick={onClick}
                className={`
                    flex items-center gap-2 transition-all duration-300
                    ${isMobile
                        ? 'flex-col text-xs p-2 justify-center w-full'
                        : 'px-4 py-2 rounded-xl text-sm font-medium hover:bg-white/10'
                    }
                    ${isActive
                        ? 'text-yellow-400 font-bold bg-white/5 shadow-[0_0_15px_rgba(250,204,21,0.2)]'
                        : 'text-slate-400 hover:text-white'
                    }
                `}
            >
                <Icon size={isMobile ? 24 : 18} className={isActive ? "stroke-[2.5px]" : ""} />
                <span>{label}</span>
            </button>
        );

        const StatusBadge = ({ status }) => {
            let colorClass = "bg-blue-500/20 text-blue-300 border-blue-500/30";
            let label = status || "Нова";
            const lower = label.toLowerCase();

            if (lower.includes("робот")) colorClass = "bg-green-500/20 text-green-300 border-green-500/30";
            if (lower.includes("відхил")) colorClass = "bg-red-500/20 text-red-300 border-red-500/30";

            return (
                <span className={`px-2.5 py-1 rounded-full text-xs font-bold border ${colorClass} uppercase tracking-wider`}>
                    {label}
                </span>
            );
        };

        // --- ОСНОВНИЙ ДОДАТОК ---
        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [ideas, setIdeas] = useState([]);
            const [loading, setLoading] = useState(false);
            const [notification, setNotification] = useState(null);

            const [localVotes, setLocalVotes] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('npu_ideas_votes')) || { support: {}, reject: {} };
                } catch {
                    return { support: {}, reject: {} };
                }
            });

            const fetchIdeas = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}?action=getData&t=${new Date().getTime()}`);
                    if (!response.ok) throw new Error("Network error");

                    const data = await response.json();

                    // Перевірка на помилку від сервера
                    if (data.status === 'error') {
                        throw new Error(data.message || "Server Error");
                    }

                    if (Array.isArray(data)) {
                        setIdeas(data.reverse());
                    } else {
                        console.warn("API Data format error:", data);
                        setIdeas([]);
                    }
                } catch (error) {
                    console.error("API Error details:", error);
                    showNotify("Помилка завантаження: " + error.message, "error");
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                if (activeTab === 'bank') fetchIdeas();
            }, [activeTab]);

            const showNotify = (msg, type = 'success') => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const renderView = () => {
                switch (activeTab) {
                    case 'home': return <HomeView onChangeTab={setActiveTab} />;
                    case 'submit': return <SubmitView showNotify={showNotify} onChangeTab={setActiveTab} />;
                    case 'bank': return <BankView ideas={ideas} loading={loading} localVotes={localVotes} setLocalVotes={setLocalVotes} showNotify={showNotify} />;
                    case 'contacts': return <ContactsView />;
                    default: return <HomeView onChangeTab={setActiveTab} />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-yellow-500/30 selection:text-yellow-200 overflow-x-hidden pb-20 md:pb-0">
                    {/* Background */}
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-900/20 rounded-full blur-[120px] animate-pulse-slow"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-indigo-900/20 rounded-full blur-[120px] animate-pulse-slow delay-1000"></div>
                    </div>

                    {/* Header */}
                    <header className="sticky top-0 z-50 backdrop-blur-xl bg-slate-950/70 border-b border-white/10">
                        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setActiveTab('home')}>
                                <Logo />
                                <span className="font-bold text-xl tracking-tight bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent">Start-UP</span>
                            </div>

                            <nav className="hidden md:flex gap-2">
                                <NavItem icon={Home} label="Головна" isActive={activeTab === 'home'} onClick={() => setActiveTab('home')} />
                                <NavItem icon={Lightbulb} label="Подати ідею" isActive={activeTab === 'submit'} onClick={() => setActiveTab('submit')} />
                                <NavItem icon={Database} label="Банк ідей" isActive={activeTab === 'bank'} onClick={() => setActiveTab('bank')} />
                                <NavItem icon={Phone} label="Контакти" isActive={activeTab === 'contacts'} onClick={() => setActiveTab('contacts')} />
                            </nav>

                            <div className="md:hidden text-sm font-medium text-slate-400">
                                {activeTab === 'home' ? 'Головна' :
                                    activeTab === 'submit' ? 'Нова ідея' :
                                        activeTab === 'bank' ? 'Банк ідей' : 'Контакти'}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="relative z-10 max-w-6xl mx-auto p-4 md:p-6 animate-fade-in">
                        {renderView()}
                    </main>

                    {/* Mobile Navigation */}
                    <div className="fixed bottom-0 left-0 right-0 z-50 bg-slate-900/90 backdrop-blur-lg border-t border-white/10 md:hidden pb-safe">
                        <div className="flex justify-around items-center h-16">
                            <NavItem isMobile icon={Home} label="Головна" isActive={activeTab === 'home'} onClick={() => setActiveTab('home')} />
                            <NavItem isMobile icon={Lightbulb} label="Подати" isActive={activeTab === 'submit'} onClick={() => setActiveTab('submit')} />
                            <NavItem isMobile icon={Database} label="Банк" isActive={activeTab === 'bank'} onClick={() => setActiveTab('bank')} />
                            <NavItem isMobile icon={Phone} label="Контакти" isActive={activeTab === 'contacts'} onClick={() => setActiveTab('contacts')} />
                        </div>
                    </div>

                    {/* Notifications */}
                    {notification && (
                        <div className={`fixed top-20 right-4 z-[100] px-4 py-3 rounded-xl shadow-2xl backdrop-blur-md flex items-center gap-3 animate-slide-in
                            ${notification.type === 'error' ? 'bg-red-500/90 text-white' : 'bg-emerald-500/90 text-white'}`}>
                            {notification.type === 'error' ? <ShieldAlert size={20} /> : <ThumbsUp size={20} />}
                            <span className="font-medium">{notification.msg}</span>
                        </div>
                    )}
                </div>
            );
        }

        // --- SUB-VIEWS ---

        function HomeView({ onChangeTab }) {
            return (
                <div className="space-y-8 py-4">
                    <section className="text-center space-y-4 py-10">
                        <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/20 text-yellow-400 text-sm font-medium mb-4">
                            <span className="relative flex h-2 w-2">
                                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
                                <span className="relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span>
                            </span>
                            Платформа інновацій НПУ
                        </div>
                        <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight text-white drop-shadow-lg">
                            Твоя ідея змінить <br />
                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-600">
                                Майбутнє Поліції
                            </span>
                        </h1>
                        <p className="text-slate-400 text-lg max-w-2xl mx-auto leading-relaxed">
                            Це простір для твоїх ініціатив. Пропонуй зміни, голосуй за найкращі рішення та допомагай розвивати Національну поліцію України.
                        </p>
                    </section>

                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="group relative bg-slate-800/40 border border-white/5 p-8 rounded-3xl hover:bg-slate-800/60 transition-all duration-300 hover:-translate-y-1">
                            <div className="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-purple-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div className="w-14 h-14 bg-blue-500/20 rounded-2xl flex items-center justify-center text-blue-400 mb-6 group-hover:scale-110 transition-transform">
                                <Lightbulb size={28} />
                            </div>
                            <h2 className="text-2xl font-bold text-white mb-3">Маєш ідею?</h2>
                            <p className="text-slate-400 mb-6 leading-relaxed">
                                Бажаєш покращити робочий процес, запропонувати технічне нововведення або змінити підхід до служби? Твій голос важливий.
                            </p>
                            <button onClick={() => onChangeTab('submit')} className="flex items-center gap-2 text-blue-400 font-bold hover:text-blue-300 group-hover:gap-3 transition-all cursor-pointer z-20 relative">
                                Подати ідею <ChevronRight size={18} />
                            </button>
                        </div>

                        <div className="group relative bg-slate-800/40 border border-white/5 p-8 rounded-3xl hover:bg-slate-800/60 transition-all duration-300 hover:-translate-y-1">
                            <div className="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-teal-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div className="w-14 h-14 bg-emerald-500/20 rounded-2xl flex items-center justify-center text-emerald-400 mb-6 group-hover:scale-110 transition-transform">
                                <Database size={28} />
                            </div>
                            <h2 className="text-2xl font-bold text-white mb-3">Підтримай колег</h2>
                            <p className="text-slate-400 mb-6 leading-relaxed">
                                Переглядай банк ідей, голосуй за найкращі пропозиції та долучайся до обговорення в коментарях.
                            </p>
                            <button onClick={() => onChangeTab('bank')} className="flex items-center gap-2 text-emerald-400 font-bold hover:text-emerald-300 group-hover:gap-3 transition-all cursor-pointer z-20 relative">
                                Переглянути банк <ChevronRight size={18} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function SubmitView({ showNotify, onChangeTab }) {
            const [formData, setFormData] = useState({ author: '', phone: '', content: '' });
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.content.trim()) return showNotify("Опишіть вашу ідею!", "error");

                setIsSubmitting(true);
                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        headers: { "Content-Type": "text/plain;charset=utf-8" },
                        body: JSON.stringify({ action: 'create_idea', ...formData })
                    });
                    showNotify("Ідею успішно додано!");
                    setFormData({ author: '', phone: '', content: '' });
                    setTimeout(() => onChangeTab('bank'), 1000);
                } catch (error) {
                    console.error(error);
                    showNotify("Помилка відправки. Спробуйте пізніше.", "error");
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="max-w-2xl mx-auto py-6">
                    <div className="bg-slate-800/50 backdrop-blur-md border border-white/10 rounded-3xl p-6 md:p-8 shadow-2xl">
                        <div className="flex items-center gap-4 mb-8">
                            <div className="p-3 bg-yellow-500/10 rounded-xl text-yellow-500">
                                <Lightbulb size={32} />
                            </div>
                            <div>
                                <h2 className="text-2xl font-bold text-white">Нова ідея</h2>
                                <p className="text-slate-400 text-sm">Детально опишіть вашу пропозицію</p>
                            </div>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="space-y-2">
                                <label className="text-sm font-medium text-slate-300 ml-1">Ваше ім'я (необов'язково)</label>
                                <div className="relative">
                                    <User className="absolute left-4 top-3.5 text-slate-500" size={18} />
                                    <input
                                        type="text"
                                        placeholder="Андрій Петренко"
                                        className="w-full bg-slate-900/50 border border-white/10 rounded-xl py-3 pl-11 pr-4 focus:ring-2 focus:ring-yellow-500/50 focus:border-yellow-500/50 transition-all outline-none text-white placeholder-slate-600"
                                        value={formData.author}
                                        onChange={e => setFormData({ ...formData, author: e.target.value })}
                                    />
                                </div>
                            </div>

                            <div className="space-y-2">
                                <label className="text-sm font-medium text-slate-300 ml-1">Телефон (необов'язково)</label>
                                <div className="relative">
                                    <Phone className="absolute left-4 top-3.5 text-slate-500" size={18} />
                                    <input
                                        type="tel"
                                        placeholder="+380 XX XXX XX XX"
                                        className="w-full bg-slate-900/50 border border-white/10 rounded-xl py-3 pl-11 pr-4 focus:ring-2 focus:ring-yellow-500/50 focus:border-yellow-500/50 transition-all outline-none text-white placeholder-slate-600"
                                        value={formData.phone}
                                        onChange={e => setFormData({ ...formData, phone: e.target.value })}
                                    />
                                </div>
                            </div>

                            <div className="space-y-2">
                                <label className="text-sm font-medium text-slate-300 ml-1">Опис ідеї *</label>
                                <textarea
                                    rows="6"
                                    placeholder="Я пропоную..."
                                    required
                                    className="w-full bg-slate-900/50 border border-white/10 rounded-xl p-4 focus:ring-2 focus:ring-yellow-500/50 focus:border-yellow-500/50 transition-all outline-none text-white placeholder-slate-600 resize-none"
                                    value={formData.content}
                                    onChange={e => setFormData({ ...formData, content: e.target.value })}
                                ></textarea>
                            </div>

                            <button
                                type="submit"
                                disabled={isSubmitting}
                                className="w-full bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-400 hover:to-amber-500 text-slate-900 font-bold py-4 rounded-xl shadow-lg transform active:scale-95 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {isSubmitting ? (
                                    <Loader2 className="animate-spin" size={20} />
                                ) : (
                                    <>
                                        <Send size={20} /> Відправити ідею
                                    </>
                                )}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        function BankView({ ideas, loading, localVotes, setLocalVotes, showNotify }) {
            const [search, setSearch] = useState('');
            const [selectedIdea, setSelectedIdea] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10;

            const filteredIdeas = useMemo(() => {
                return ideas.filter(idea =>
                    (idea.content && idea.content.toLowerCase().includes(search.toLowerCase())) ||
                    (idea.author && idea.author.toLowerCase().includes(search.toLowerCase()))
                );
            }, [ideas, search]);

            // Скидання сторінки при пошуку
            useEffect(() => {
                setCurrentPage(1);
            }, [search]);

            // Логіка пагінації
            const totalPages = Math.ceil(filteredIdeas.length / itemsPerPage);
            const indexOfLastItem = currentPage * itemsPerPage;
            const indexOfFirstItem = indexOfLastItem - itemsPerPage;
            const currentItems = filteredIdeas.slice(indexOfFirstItem, indexOfLastItem);

            const handleVote = async (id, type) => {
                if (localVotes.support[id] || localVotes.reject[id]) return;

                const newVotes = { ...localVotes, [type === 'up' ? 'support' : 'reject']: { ...localVotes[type === 'up' ? 'support' : 'reject'], [id]: true } };
                setLocalVotes(newVotes);
                localStorage.setItem('npu_ideas_votes', JSON.stringify(newVotes));

                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        headers: { "Content-Type": "text/plain;charset=utf-8" },
                        body: JSON.stringify({ action: 'vote', id, type })
                    });
                    showNotify(type === 'up' ? "Ви підтримали цю ідею!" : "Ваш голос враховано");
                } catch {
                    showNotify("Помилка збереження голосу на сервері", "error");
                }
            };

            return (
                <div className="space-y-6">
                    <div className="sticky top-0 z-30 bg-slate-950/80 backdrop-blur-xl py-4 -mx-4 px-4 md:mx-0 md:px-0 border-b md:border-none border-white/5">
                        <div className="relative">
                            <Search className="absolute left-4 top-3.5 text-slate-500" size={20} />
                            <input
                                type="text"
                                placeholder="Пошук ідей..."
                                className="w-full bg-slate-900 border border-white/10 rounded-2xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 outline-none text-white placeholder-slate-600 shadow-inner"
                                value={search}
                                onChange={e => setSearch(e.target.value)}
                            />
                        </div>
                    </div>

                    {loading ? (
                        <div className="flex flex-col items-center justify-center py-20 text-slate-500 space-y-4">
                            <Loader2 className="w-10 h-10 text-yellow-500 animate-spin" />
                            <p>Завантаження бази даних...</p>
                        </div>
                    ) : filteredIdeas.length === 0 ? (
                        <div className="text-center py-20 text-slate-500">
                            <Database size={48} className="mx-auto mb-4 opacity-20" />
                            <p>Ідей не знайдено</p>
                        </div>
                    ) : (
                        <>
                            <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-1">
                                {currentItems.map(idea => (
                                    <div key={idea.id} className="bg-slate-800/40 border border-white/5 rounded-2xl p-5 hover:bg-slate-800/60 transition-all shadow-lg backdrop-blur-sm group">
                                        <div className="flex justify-between items-start mb-3">
                                            <StatusBadge status={idea.status} />
                                            <span className="text-xs font-mono text-slate-600">#{idea.id}</span>
                                        </div>

                                        <h3 className="text-lg font-medium text-slate-200 mb-4 line-clamp-3">{idea.content}</h3>

                                        <div className="flex items-center justify-between text-sm text-slate-500 border-t border-white/5 pt-4">
                                            <div className="flex items-center gap-3">
                                                <span className="flex items-center gap-1"><User size={14} /> {idea.author || 'Анонім'}</span>
                                                <span className="flex items-center gap-1"><Clock size={14} /> {new Date(idea.date).toLocaleDateString('uk-UA')}</span>
                                            </div>

                                            <div className="flex items-center gap-2">
                                                <button
                                                    onClick={() => handleVote(idea.id, 'up')}
                                                    disabled={localVotes.support[idea.id] || localVotes.reject[idea.id]}
                                                    className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors ${localVotes.support[idea.id] ? 'bg-green-500/20 text-green-400' : 'bg-white/5 hover:bg-white/10'}`}
                                                >
                                                    <ThumbsUp size={16} /> <span>{idea.upvotes || 0}</span>
                                                </button>

                                                <button
                                                    onClick={() => handleVote(idea.id, 'down')}
                                                    disabled={localVotes.support[idea.id] || localVotes.reject[idea.id]}
                                                    className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors ${localVotes.reject[idea.id] ? 'bg-red-500/20 text-red-400' : 'bg-white/5 hover:bg-white/10'}`}
                                                >
                                                    <ThumbsDown size={16} /> <span>{idea.downvotes || 0}</span>
                                                </button>

                                                <button
                                                    onClick={() => setSelectedIdea(idea)}
                                                    className="p-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-blue-400"
                                                >
                                                    <MessageSquare size={16} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Pagination Controls */}
                            {totalPages > 1 && (
                                <div className="flex justify-center items-center gap-2 mt-8 pb-8">
                                    <button
                                        onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                                        disabled={currentPage === 1}
                                        className="p-2 rounded-lg bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed transition-colors text-slate-300 hover:text-white"
                                    >
                                        <ChevronLeft size={20} />
                                    </button>

                                    <div className="flex gap-1 overflow-x-auto max-w-[200px] md:max-w-none scrollbar-hide">
                                        {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (
                                            <button
                                                key={page}
                                                onClick={() => setCurrentPage(page)}
                                                className={`w-8 h-8 rounded-lg text-sm font-medium transition-colors flex-shrink-0
                                                    ${currentPage === page
                                                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/25'
                                                        : 'bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white'
                                                    }`}
                                            >
                                                {page}
                                            </button>
                                        ))}
                                    </div>

                                    <button
                                        onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                                        disabled={currentPage === totalPages}
                                        className="p-2 rounded-lg bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed transition-colors text-slate-300 hover:text-white"
                                    >
                                        <ChevronRight size={20} />
                                    </button>
                                </div>
                            )}
                        </>
                    )}

                    {selectedIdea && (
                        <IdeaModal
                            idea={selectedIdea}
                            onClose={() => setSelectedIdea(null)}
                            showNotify={showNotify}
                        />
                    )}
                </div>
            );
        }

        function IdeaModal({ idea, onClose, showNotify }) {
            const [comments, setComments] = useState([]);
            const [isLoadingComments, setIsLoadingComments] = useState(false);
            const [commentText, setCommentText] = useState('');
            const [authorName, setAuthorName] = useState(() => localStorage.getItem('npu_nickname') || '');
            const [isPosting, setIsPosting] = useState(false);

            useEffect(() => {
                const fetchComments = async () => {
                    setIsLoadingComments(true);
                    try {
                        const res = await fetch(`${API_URL}?action=get_comments&id=${idea.id}`);
                        const data = await res.json();
                        setComments(data);
                    } catch (e) {
                        console.error("Failed to load comments", e);
                    } finally {
                        setIsLoadingComments(false);
                    }
                };
                fetchComments();
            }, [idea.id]);

            const handlePostComment = async () => {
                if (!commentText.trim() || !authorName.trim()) {
                    showNotify("Введіть ім'я та коментар", "error");
                    return;
                }

                localStorage.setItem('npu_nickname', authorName);
                setIsPosting(true);

                const newComment = {
                    author: authorName,
                    text: commentText,
                    date: new Date().toISOString()
                };
                setComments([...comments, newComment]);
                setCommentText('');

                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        headers: { "Content-Type": "text/plain;charset=utf-8" },
                        body: JSON.stringify({
                            action: 'add_comment',
                            ideaId: idea.id,
                            text: newComment.text,
                            author: newComment.author
                        })
                    });
                } catch (e) {
                    showNotify("Помилка відправки коментаря", "error");
                } finally {
                    setIsPosting(false);
                }
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in" onClick={onClose}>
                    <div className="bg-slate-900 border border-white/10 w-full max-w-lg rounded-3xl p-6 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-start mb-4 flex-shrink-0">
                            <h2 className="text-xl font-bold text-white">Ідея #{idea.id}</h2>
                            <button onClick={onClose} className="p-1 hover:bg-white/10 rounded-full text-slate-400 hover:text-white"><X size={20} /></button>
                        </div>

                        <div className="bg-slate-800/50 rounded-xl p-4 mb-6 text-slate-300 leading-relaxed overflow-y-auto flex-shrink-0 max-h-[30vh] border border-white/5">
                            {idea.content}
                        </div>

                        <div className="flex flex-col flex-grow min-h-0">
                            <h3 className="text-sm font-bold uppercase tracking-wider text-slate-500 mb-3 flex items-center gap-2">
                                <MessageSquare size={14} /> Обговорення
                            </h3>

                            <div className="flex-grow overflow-y-auto space-y-3 mb-4 pr-2">
                                {isLoadingComments ? (
                                    <div className="text-center py-4 text-slate-500"><Loader2 className="animate-spin mx-auto" /></div>
                                ) : comments.length === 0 ? (
                                    <div className="text-center py-4 text-slate-600 text-sm">Коментарів ще немає. Будьте першим!</div>
                                ) : (
                                    comments.map((c, idx) => (
                                        <div key={idx} className="bg-slate-950/50 p-3 rounded-xl border border-white/5 text-sm">
                                            <div className="flex justify-between items-center mb-1">
                                                <span className="font-bold text-blue-400">{c.author}</span>
                                                <span className="text-xs text-slate-600">{new Date(c.date).toLocaleDateString()}</span>
                                            </div>
                                            <p className="text-slate-300">{c.text}</p>
                                        </div>
                                    ))
                                )}
                            </div>

                            <div className="space-y-3 pt-3 border-t border-white/10 mt-auto">
                                <input
                                    type="text"
                                    placeholder="Ваш нікнейм"
                                    className="w-full bg-slate-950/50 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-blue-500/50 outline-none"
                                    value={authorName}
                                    onChange={e => setAuthorName(e.target.value)}
                                />
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        placeholder="Ваш коментар..."
                                        className="flex-1 bg-slate-950/50 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-blue-500/50 outline-none"
                                        value={commentText}
                                        onChange={e => setCommentText(e.target.value)}
                                        onKeyDown={e => e.key === 'Enter' && handlePostComment()}
                                    />
                                    <button
                                        onClick={handlePostComment}
                                        disabled={isPosting}
                                        className="bg-blue-600 hover:bg-blue-500 text-white rounded-lg px-4 py-2 transition-colors disabled:opacity-50"
                                    >
                                        {isPosting ? <Loader2 size={18} className="animate-spin" /> : <Send size={18} />}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function ContactsView() {
            return (
                <div className="max-w-md mx-auto py-10">
                    <div className="text-center mb-8">
                        <div className="w-20 h-20 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-yellow-500">
                            <Phone size={40} />
                        </div>
                        <h2 className="text-2xl font-bold text-white">Зв'яжіться з нами</h2>
                        <p className="text-slate-400 mt-2">Долучайтеся до нашої спільноти</p>
                    </div>

                    <div className="bg-slate-800/40 backdrop-blur-md border border-white/5 rounded-3xl overflow-hidden">
                        <div className="p-6 space-y-6">
                            <a href="https://dgidpl.com.ua/" target="_blank" rel="noopener noreferrer" className="flex items-center gap-4 group hover:bg-white/5 p-3 rounded-xl transition-all">
                                <div className="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400 group-hover:scale-110 transition-transform">
                                    <Globe size={20} />
                                </div>
                                <div className="flex-1">
                                    <p className="text-xs text-slate-500 uppercase tracking-wider font-bold">Наш сайт</p>
                                    <p className="text-white group-hover:text-blue-400 transition-colors">dgidpl.com.ua</p>
                                </div>
                                <div className="text-slate-600 group-hover:text-white"><ChevronRight size={16} /></div>
                            </a>

                            <a href="https://chat.whatsapp.com/JXmbaeRhsL83qLeYUwjkp0?mode=gi_t" target="_blank" rel="noopener noreferrer" className="flex items-center gap-4 group hover:bg-white/5 p-3 rounded-xl transition-all">
                                <div className="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-400 group-hover:scale-110 transition-transform">
                                    <MessageSquare size={20} />
                                </div>
                                <div className="flex-1">
                                    <p className="text-xs text-slate-500 uppercase tracking-wider font-bold">Комунікативна група</p>
                                    <p className="text-white group-hover:text-green-400 transition-colors">WhatsApp Community</p>
                                </div>
                                <div className="text-slate-600 group-hover:text-white"><ChevronRight size={16} /></div>
                            </a>
                        </div>

                        <div className="h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-yellow-500"></div>
                    </div>
                </div>
            );
        }

        // Рендер додатку
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
